# Development Conventions and Standards

## Project Configuration

- Must use the `<Nullable>enable</Nullable>` configuration item.

## Entity Model Definition

- All entity classes inherit from `EntityBase` by default, which defines commonly used properties such as `Id`, `CreatedAt`, `UpdatedAt`, `IsDeleted`.
- The `Id` property uses the `Guid` type by default, generated by the client using Guid V7.
- For string types, define a maximum length unless explicitly unlimited.
- For decimal types, precision and decimal places need to be explicit.
  - For smaller range decimal types, it is recommended to use decimal(10, 2)
  - For larger range decimal types, it is recommended to use decimal(18, 6)
  
    ```csharp
    [Column(TypeName = "decimal(10,2)")]
    public decimal TotalPrice { get; set; }
    ```

- All enum values must add the `[Description]` attribute.
- Use `DateTimeOffset` for time types, not `DateTime`, to ensure time information is complete.
- For properties that are explicitly dates only, use the `DateOnly` type.
- For properties that are explicitly times only, use the `TimeOnly` type.

## Services and Helper Classes

Helper classes usually end with Helper, and Helper classes are usually static classes, not related to DI.

Service classes usually end with Service, and Service classes are usually implementation classes that usually need to be injected into DI.

## Business Manager

- Usually do not define interfaces for business implementation (Manager) classes. In reality, businesses are variable and there is only one implementation class. Unless there is a strict business process and a need for multiple implementation classes.
- Manager inherits the `ManagerBase` class and will be automatically injected into DI. If not inherited, manual injection is required.

## API Request and Response

Overall based on RESTful style.

Controller method naming is simple and consistent. For example, to add a user, use AddAsync directly instead of AddUserAsync, such as:

- Add/Create: AddAsync
- Modify/Update: UpdateAsync
- Delete: DeleteAsync
- Query Details: GetDetailAsync
- Filter Query: FilterAsync

### Request Methods

- GET: Use GET to retrieve data. For complex filtering and conditional queries, you can use POST to pass parameters.
- POST: Use POST to add data. Body parameters use JSON format.
- PUT: Use PUT to modify data. Body parameters use JSON format.
- DELETE: Use DELETE to delete data.

### Request Response

Returns are based on HTTP status codes.

- 200: Executed successfully.
- 201: Created successfully.
- 401: Unauthorized, no token passed or token has expired. Need to get token again (login).
- 403: Forbidden access, refers to logged-in users but no permission to access.
- 404: Requested resource does not exist.
- 409: Resource conflict.
- 500: Error return, server error or business error encapsulation.

When the API request is successful, the frontend can directly get the data.

When the API request fails, a unified error format is returned.

The frontend determines whether the request is successful based on the HTTP status code, and then gets the data.

The error return format is as follows:

```json
{
  "title": "",
  "status": 500,
  "detail": "Unknown error!",
  "traceId": "00-d768e1472decd92538cdf0a2120c6a31-a9d7310446ea4a3f-00"
}
```

### ASP.NET Core Request Response Examples

1. Route definition, conventionally use HTTP verbs, do not use Route.
Please refer to [**HTTP Verb Templates**](https://docs.microsoft.com/en-us/aspnet/core/mvc/controllers/routing?view=aspnetcore-6.0#http-verb-templates).
2. **Model Binding**, you can use `[Frombody]` and `[FromRoute]` to specify the request source,
see [**Request Sources**](https://docs.microsoft.com/en-us/aspnet/core/mvc/models/model-binding?view=aspnetcore-6.0#sources), such as:

```csharp
// Modify information
[HttpPut("{id}")]
public async Task<ActionResult<TEntity?>> UpdateAsync([FromRoute] Guid id, TUpdate form)
```

3. Regarding return types, please use [ActionResult&#60;T&#62; or specific types](https://docs.microsoft.com/en-us/aspnet/core/web-api/action-return-types?view=aspnetcore-6.0#actionresult-vs-iactionresult) as return types.

- Normal return, can directly return specific type data.
- Error return, use Problem(), such as:

```csharp
// If error, use Problem to return content
return Problem("Unknown error!", title: "Business error");
```

- 404, use NotFound(), such as:

```csharp
// If not exist, return 404
return NotFound("Username password does not exist");
```

