# 疑难问题

本文档收集了一些在使用 Ater.Dry 过程中可能遇到的疑难问题及其解决方案。如果你在使用过程中遇到其他问题，欢迎通过 [GitHub 讨论区]() 提出，我们将持续更新此文档以帮助更多用户。

## 不支持ARM芯片

部分苹果电脑使用ARM芯片，当前Ater.Dry不支持ARM芯片。

## OpenApi问题

微软提供的官方OpenApi一直都不完善，经历两个大版本，仍然然存在很多问题。

多说一句，使用`json schema`来表示`openapi文档`，本身就是一个错误的设计。

### The depth of the generated JSON schema exceeds the JsonSerializerOptions.MaxDepth setting

这个问题多半是**实体间的互相引用**导致的，而且它并不会与你配置的`JsonOptions`保持一致，也没有提供任何配置项来调整它。

这是一个很常见的情况，但官方`OpenApi`比较拉胯，目前没有什么太好的方式解决。

比如实体`User`中定义了很多个导航属性，而这些导航属性中又引用了`User`实体，很可能会出现这个报错。
详细信息可以参考：[Github issue](https://github.com/dotnet/aspnetcore/issues/58943).

**解决方法：**

1. 👌返回时，定义新的`DTO`，不要直接返回实体。
2. 👎在关联属性上添加`[JsonIgnore]`属性，避免Json解析时引用。
3. 🤔等待官方库修复。

> [!TIP]
> 建议不要直接返回实体，而是通过定义`DTO`来返回数据。

### 不支持XML注释

在.NET10中已经添加了对XML注释的支持，但是有一些限制😅，就很恶心人。

1. 你必须在WebApi项目中调用`services.AddOpenApi`来注入服务，因为使用了源代码生成器。这意味着你不能在其他程序集中复用，你需要在**每个**WebApi项目中都添加一遍。

2. 你必须在WebApi项目中引用`OpenApi`包依赖，不可在其他程序集中引用，否则可能会报错，或无法正常生成相关的xml注释。

### 生成错误的请求服务

由于请求服务是通过读取OpenApi文档来生成的，而OpenApi可能在某些情况下生成不合预期的内容，导致生成的请求服务代码有问题。

**解决方法：**

1. 到官方库提交issue，等待修复。

> [!IMPORTANT]
> 模板本身使用`Swashbuckle.AspNetCore`来生成OpenApi文档，并提供了一些扩展功能来增强生成的文档质量，能够更好的支持代码生成器的使用。