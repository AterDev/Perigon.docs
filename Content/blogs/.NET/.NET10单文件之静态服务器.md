# .NET10单文件运行之静态服务器

.NET 10 引入了`file-based`功能，也就是单文件运行的功能。不同于其他`脚本`语言，.NET 10 的单文件运行，支持sdk/package等功能，适用范围更广泛。

今天给大家分享一下，我在实际项目中，使用它的一个场景和经验。

## 背景

最近我在完善我的项目`Perigon.CLI`，打算在`2026.01.01`发布，目前已经到了文档完善阶段。

文档是通过静态站点生成工具[`Ater.EasyDocs`](https://github.com/AterDev/EasyDocs)生成的，这是我的另一个开源项目。最近开始升级它，并添加和修复一些功能。

在开发测试过程中，需要对生成后的静态站点进行预览，查看效果。之前我使用的是`Node.js`的`http-server`来启动一个本地静态服务器。不过由于一个半月前我重装了操作系统，虽然安装了`Node.js`，但是并没有安装`http-server`，我就想到使用一个.cs文件运行`Asp.Net Core`服务，`Asp.Net Core`服务支持加载静态文件，可充当静态服务器。

## 实现

于是我就让AI生成了一个`Asp.Net Core`使用静态文件的代码，然后进行了一些修改，最终代码如下：
```csharp
#:sdk Microsoft.NET.Sdk.Web
// 解析参数：根目录和端口
var baseDir = Directory.GetCurrentDirectory();
var root = args.Length > 0 && !string.IsNullOrWhiteSpace(args[0])
    ? Path.GetFullPath(args[0])
    : Path.Combine(baseDir, "WebSite");

var port = args.Length > 1 && int.TryParse(args[1], out var p) ? p : 5200;

// 创建并配置应用
var builder = WebApplication.CreateBuilder(new WebApplicationOptions
{
    Args = args,
    ContentRootPath = root,
    WebRootPath = root
});

builder.WebHost.UseUrls($"http://localhost:{port}");

var app = builder.Build();
app.UseStaticFiles();
app.MapFallbackToFile("index.html");

await app.RunAsync();
```

我把它保存为`preview.cs`文件。短短20多行代码，我就有了支持指定`目录和端口`的静态服务器，直接使用`dotnet run preview.cs`运行即可。

## 启发

这不是我第一次使用.NET的单文件运行了，对于一些不太复杂，或者没有工程性要求的项目，可以非常方便的编写一个.cs文件来实现需求，它比`Python`更加容易和可靠，只要安装了.NET SDK，不需要打包和发布，就可以直接运行。

对于我遇到的这个场景，我可以节省安装`http-server`的空间，减少`Node.js`生态及工具链的污染，还是非常不错的。

更为重要的是，这是源代码，你可以根据需要进行修改和扩展，不需要去查看命令帮助和文档，完全自定义。